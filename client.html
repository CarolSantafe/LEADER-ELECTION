<!DOCTYPE html>
<html>

<head>
  <title>Client</title>
  <script src="https://cdn.socket.io/4.1.3/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
  <div class="content">
    <div class="server-list">
      <h1>LEADER ELECTION</h1>
      <p id="current-time"></p>
      <ul id="serverList">
      </ul>

      <div class="input-container">
        <div class="input-group">
          <input type="text" id="clientValue" placeholder="Ingrese el ID del contenedor">
          <button onclick="createContainer()" id="createClientBtn">
            Crear Contenedor
          </button>
          <button onclick="viewLogs()" id="viewLogsBtn">
            Ver Logs
          </button>
        </div>

        <div id="serverStatus">
          <div id="responseTableContainer">
            <table id="responseTable">
              <thead>
                <tr>
                  <th>ROL</th>
                  <th>ID</th>
                  <th>NOMBRE</th>
                  <th>ESTADO</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ðŸ‘‘ Lider</td>
                  <td>5</td>
                  <td>server1</td>
                  <td><button>Detener</button> ðŸŸ¢ Activo</td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td><button>Detener</button></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td><button>Detener</button></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    window.onload = () => {
      connectSocket();
    };

    const socket = io("http://192.168.248.1.103:5000/", {
      transports: ["websocket"],
      withCredentials: false,
      extraHeaders: {
        "Access-Control-Allow-Origin": "*",
        "Access-Control-Allow-Methods": "GET, POST",
        "Access-Control-Allow-Headers": "Content-Type",
      },
    });

    socket.on("connect", () => {
      console.log("Socket conectado:", socket);
    });

    socket.on("disconnect", () => {
      console.log("Socket desconectado");
    });

    socket.on("servers", (servers) => {
      console.log("Lista de servidores actualizada:", servers);
      updateServerList(servers);
    });

    async function updateServerList(servers) {
      const serverStatusContainer = document.getElementById("serverStatus");
      // Puedes generar las filas y columnas dinÃ¡micamente aquÃ­ si prefieres datos dinÃ¡micos
    }

    async function createContainer() {
      const inputValue = document.getElementById("clientValue").value;
      if (inputValue.trim() === "") {
        alert("Por favor, llene el campo solicitado.");
      } else if (!isNaN(inputValue)) {
        try {
          const response = await fetch(
            "http://192.168.248.1:5000/startNewContainer",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
            }
          );
          const result = await response.text();
          console.log(result);

          const serverName = 'NombreServidor'; // AquÃ­ debes obtener el nombre real del servidor

          const emojiFirstCell = result === "true" ? "ðŸ‘‘ Lider" : "ðŸ«¡ Cliente";

          const emojiLastCell = result === "true" ? "ðŸŸ¢ Avtivo" : "ðŸ”´ Inactivo";

          const tableBody = document.querySelector("#responseTable tbody");
          const newRow = tableBody.insertRow();
          newRow.innerHTML = `<td>${emojiFirstCell}</td><td>${inputValue}</td><td>${serverName}</td><td>${emojiLastCell}</td>`;
        } catch (error) {
          console.error(error);
        }
      } else {
        alert("Por favor, ingrese un valor numÃ©rico en el campo solicitado.");
      }
    }

    async function stopContainer() {
      const inputValue = document.getElementById("clientValue").value;
      if (inputValue.trim() === "") {
        alert("Por favor, llene el campo solicitado.");
      } else if (!isNaN(inputValue)) {
        try {
          const response = await fetch(
            "http://192.168.248.1:5000/stopContainer",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
            }
          );
          const result = await response.text();
          console.log(result);

          // AquÃ­ puedes manejar la respuesta y actualizar la tabla si es necesario
        } catch (error) {
          console.error(error);
        }
      } else {
        alert("Por favor, ingrese un valor numÃ©rico en el campo solicitado.");
      }
    }

    function viewLogs() {
      window.location.href = "Logs.html";
    }

    function connectSocket() {
      socket.emit("getServers");

      socket.on("servers", (servers) => {
        console.log("Lista de servidores recibida:", servers);
        updateServerList(servers);
      });
    }
  </script>
</body>

</html>